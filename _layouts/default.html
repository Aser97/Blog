<!doctype html>
{% if page.menubar or page.menubar_toc %}
    {% assign has_left_sidebar = true %}
{% endif %}

{% if page.show_sidebar and has_left_sidebar %}
    {% assign content_width = 'is-4' %}
{% elsif page.show_sidebar or has_left_sidebar %}
    {% assign content_width = 'is-8' %}
{% else %}
    {% assign content_width = 'is-12' %}
{% endif %}

<html
    dir="{{ site.direction | default: 'ltr' }}"
    lang="{{ site.lang | default: 'en' }}"
    class="{% if site.fixed_navbar %} has-navbar-fixed-{{ site.fixed_navbar }} {% endif %} {% if site.force_theme %} theme-{{ site.force_theme }} {% endif %}"
>

    {% include head.html %}

    <body>
        {% if site.cookie_policy %}
            {% include cookie-banner.html %}
        {% endif %}
        {% include header.html %}
        {% unless page.hide_hero %}
            {% include hero.html %}
        {% endunless %}
        {% include callouts.html %}
        <main id="content" class="section" role="main">
            <div class="container">
                <div class="columns is-multiline">
                  {% if page.menubar_toc %}
                    <div class="column is-12-mobile is-4-tablet is-3-desktop ms-toc">
                      {% assign contentsTitle = page.toc_title | default: 'Contents' %}
                      {% include toc.html html=content class='menu-list' h_min=2 h_max=3 contents_title=contentsTitle %}

                      {%- comment -%} --- Dynamic resource thumbnails (one or many) --- {%- endcomment -%}
                      {% if page.sidebar_docs %}
                        <div class="ms-toc-docs">
                          <p class="menu-label">{{ page.sidebar_docs_label | default: '📘 Resources' }}</p>

                          {% for doc in page.sidebar_docs %}
                            {%- assign href = doc.url -%}
                            {%- if href and href != '' and href contains '://' -%}
                              {%- assign final_href = href -%}
                            {%- else -%}
                              {%- assign final_href = href | relative_url -%}
                            {%- endif -%}

                            {%- assign thumb = doc.thumb | default: '/assets/thumbnails/default-doc.png' -%}
                            {%- if thumb and thumb != '' and thumb contains '://' -%}
                              {%- assign final_thumb = thumb -%}
                            {%- else -%}
                              {%- assign final_thumb = thumb | relative_url -%}
                            {%- endif -%}

                            {%- assign is_circle = false -%}
                            {%- if final_thumb contains 'jupyter' or final_thumb contains 'github' -%}
                              {%- assign is_circle = true -%}
                            {%- endif -%}

                            <a href="{{ final_href }}" target="_blank" class="ms-toc-doc">
                              <div class="preview-container ms-toc-preview{% if is_circle %} circle{% endif %}">
                                <img src="{{ final_thumb }}" alt="{{ doc.label | default: 'Document' }}"
                                     loading="eager" decoding="sync" fetchpriority="high">                                <div class="hover-effect">Open</div>
                              </div>
                              {% if doc.label %}
                                <div class="is-size-7" style="margin-top:.35rem">{{ doc.label }}</div>
                              {% endif %}
                            </a>
                          {% endfor %}
                        </div>
                      {% else %}
                        {%- assign sb_link  = page.sidebar_link | default: page.pdf_url | default: page.hero_link -%}
                        {%- assign sb_label = page.sidebar_label -%}

                        {% if sb_label == nil or sb_label == '' %}
                          {% if sb_link %}
                            {% assign ext = sb_link | split:'?' | first | split:'#' | first | split:'.' | last | downcase %}
                            {% case ext %}
                              {% when 'pdf' %}{% assign sb_label = '📘 PDF' %}
                              {% when 'ppt','pptx','key' %}{% assign sb_label = '📊 Slides' %}
                              {% when 'ipynb' %}{% assign sb_label = '📓 Notebook' %}
                              {% when 'zip','tar','gz','tgz' %}{% assign sb_label = '📦 Download' %}
                              {% when 'md' %}{% assign sb_label = '📝 Document' %}
                              {% else %}{% assign sb_label = '🔗 Resource' %}
                            {% endcase %}
                          {% else %}
                            {% assign sb_label = '🔗 Resource' %}
                          {% endif %}
                        {% endif %}

                        {% if sb_link %}
                          {% assign href = sb_link %}
                          {% if href and href != '' and href contains '://' %}
                            {% assign final_href = href %}
                          {% else %}
                            {% assign final_href = href | relative_url %}
                          {% endif %}

                          {% assign thumb_path = page.sidebar_thumb | default: '/assets/thumbnails/default-doc.png' %}
                          {% if thumb_path and thumb_path != '' and thumb_path contains '://' %}
                            {% assign final_thumb = thumb_path %}
                          {% else %}
                            {% assign final_thumb = thumb_path | relative_url %}
                          {% endif %}

                          {% assign is_circle = false %}
                          {% if final_thumb contains 'jupyter' or final_thumb contains 'github' %}
                            {% assign is_circle = true %}
                          {% endif %}

                          <div class="ms-toc-pdf">
                            <p class="menu-label">{{ sb_label }}</p>
                            <a href="{{ final_href }}" target="_blank">
                              <div class="preview-container ms-toc-preview{% if is_circle %} circle{% endif %}">
                                <img src="{{ final_thumb }}" alt="Open {{ sb_label | strip_html }}"
                                     loading="eager" decoding="sync" fetchpriority="high">
                                <div class="hover-effect">Click to view</div>
                              </div>
                            </a>
                          </div>
                        {% endif %}
                      {% endif %}
                    </div>
                  {% elsif page.menubar %}
                    <div class="column is-4-desktop is-4-tablet">
                      {% include menubar.html %}
                    </div>
                  {% endif %}
                  <div class="column {{ content_width }}">
                        {% include tabs.html %}
                        {% include showcase.html %}
                        {% include sponsors.html %}
                        {% include gallery.html %}
                        {{ content }}
                  </div>
                  {% if site.posts and page.show_sidebar %}
                        <div class="column is-4-desktop is-4-tablet">
                            {% include latest-posts.html %}
                        </div>
                  {% endif %}
                </div>
            </div>
        </main>
        {% unless page.hide_footer %}
            {% include footer.html %}
        {% endunless %}
        <script src="{{ site.baseurl }}/assets/js/app.js" type="text/javascript"></script>
        {%- include footer-scripts.html -%}
        <script type="text/javascript" async
          src="https://polyfill.io/v3/polyfill.min.js?features=es6">
        </script>
        <script type="text/javascript" async
          src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
        </script>

        <script src="{{ '/assets/js/copy-code.js' | relative_url }}" defer></script>
    </body>
</html>
