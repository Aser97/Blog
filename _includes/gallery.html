{%- assign gid = include.id | default: page.gallery | default: page.gallery_id -%}
{%- if gid == nil or gid == "" -%}
{%- else -%}
  {%- assign g = site.data[gid] -%}
  {%- if g == nil -%}
    <p><em>Gallery “{{ gid }}” not found in <code>_data/</code>.</em></p>
  {%- else -%}
    {%- if g.images -%}
      {%- assign sections = [ g ] -%}
    {%- else -%}
      {%- assign sections = g -%}
    {%- endif -%}

    <div class="columns is-multiline">
      {%- for section in sections -%}
        {%- if section.title -%}
          <div class="column is-12"><h3 class="title is-5">{{ section.title }}</h3></div>
        {%- endif -%}

        {%- for img in section.images -%}
          {%- assign ratio = img.ratio | default: 'is-16by9' -%}

          {%- assign link = img.link -%}
          {%- if link and link != '' and link | slice: 0,1 != '/' -%}
            {%- assign link = '/' | append: link -%}
          {%- endif -%}

          {%- assign large_link = img.large_link | default: link -%}
          {%- assign alt = img.alt | default: img.caption | default: '' -%}

          <div class="column is-one-third">
            {%- include image-modal.html
              ratio=ratio
              link=link
              alt=alt
              large_link=large_link -%}
            {%- if img.description -%}
              <div class="content is-small" style="margin-top:.4rem;">
                {{ img.description | markdownify }}
              </div>
            {%- endif -%}
          </div>
        {%- endfor -%}
      {%- endfor -%}
    </div>
  {%- endif -%}
{%- endif -%}
